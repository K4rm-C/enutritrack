<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gestión de Usuarios - Sistema de Salud</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary-color: #4e73df;
        --secondary-color: #858796;
        --success-color: #1cc88a;
        --info-color: #36b9cc;
        --warning-color: #f6c23e;
        --danger-color: #e74a3b;
        --dark-color: #5a5c69;
        --light-color: #f8f9fc;
      }

      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f8f9fc;
      }

      .dashboard-body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
      }

      .bg-gradient-primary {
        background: linear-gradient(
          135deg,
          var(--primary-color) 0%,
          #2a4cb3 100%
        ) !important;
      }

      .sidebar {
        background: linear-gradient(
          180deg,
          #4e73df 0%,
          #224abe 100%
        ) !important;
        min-height: calc(100vh - 76px);
        box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
      }

      .sidebar .nav-link {
        color: rgba(255, 255, 255, 0.8) !important;
        padding: 0.75rem 1rem;
        border-left: 3px solid transparent;
        transition: all 0.3s;
      }

      .sidebar .nav-link:hover {
        color: white !important;
        background-color: rgba(255, 255, 255, 0.1);
        border-left-color: var(--warning-color);
      }

      .sidebar .nav-link.active {
        color: white !important;
        background-color: rgba(255, 255, 255, 0.2);
        border-left-color: white;
      }

      .main-content {
        padding: 2rem 0;
        background: rgba(255, 255, 255, 0.95);
        min-height: calc(100vh - 76px);
        border-radius: 20px 0 0 0;
        margin-top: -20px;
      }

      .card {
        border: none;
        border-radius: 15px;
        box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.1);
        margin-bottom: 1.5rem;
      }

      .user-card {
        transition: all 0.3s ease;
        border-left: 4px solid var(--primary-color);
      }

      .user-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
      }

      .btn {
        border-radius: 10px;
        font-weight: 500;
        transition: all 0.3s ease;
      }

      .btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
      }

      .modal-content {
        border-radius: 15px;
        border: none;
        box-shadow: 0 1rem 3rem rgba(0, 0, 0, 0.175);
      }

      .form-control,
      .form-select {
        border-radius: 10px;
        padding: 0.75rem 1rem;
      }

      .form-control:focus,
      .form-select:focus {
        box-shadow: 0 0 0 0.25rem rgba(78, 115, 223, 0.25);
        border-color: #4e73df;
      }

      .search-box {
        position: relative;
      }

      .search-box .form-control {
        padding-left: 2.5rem;
      }

      .search-box i {
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        color: var(--secondary-color);
      }

      .user-info-badge {
        font-size: 0.75rem;
        padding: 0.25rem 0.5rem;
      }
    </style>
  </head>
  <body class="dashboard-body">
    <!-- Navbar Superior -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-gradient-primary">
      <div class="container-fluid">
        <a class="navbar-brand" href="/admins/dashboard">
          <i class="fas fa-heartbeat me-2"></i>
          <strong>Sistema de Salud</strong>
        </a>
        <div class="navbar-nav ms-auto align-items-center">
          <div class="nav-item dropdown">
            <a
              class="nav-link dropdown-toggle text-white"
              href="#"
              id="userDropdown"
              role="button"
              data-bs-toggle="dropdown"
            >
              <i class="fas fa-user-circle me-1"></i>
              <span id="user-name">Administrador</span>
            </a>
            <ul class="dropdown-menu dropdown-menu-end">
              <li>
                <a class="dropdown-item" href="/admins/profile"
                  ><i class="fas fa-user me-2"></i>Mi Perfil</a
                >
              </li>
              <li><hr class="dropdown-divider" /></li>
              <li>
                <a class="dropdown-item text-danger" href="#" id="logout-btn"
                  ><i class="fas fa-sign-out-alt me-2"></i>Cerrar Sesión</a
                >
              </li>
            </ul>
          </div>
        </div>
      </div>
    </nav>

    <div class="container-fluid">
      <div class="row">
        <!-- Sidebar -->
        <nav class="col-md-3 col-lg-2 sidebar bg-dark text-white">
          <div class="position-sticky pt-4">
            <div class="sidebar-header text-center mb-4">
              <h5 class="text-warning">Panel de Control</h5>
            </div>
            <ul class="nav flex-column">
              <li class="nav-item mb-2">
                <a class="nav-link" href="/admins/dashboard">
                  <i class="fas fa-tachometer-alt me-2"></i>Dashboard
                </a>
              </li>
              <li class="nav-item mb-2">
                <a class="nav-link" href="/doctors/management">
                  <i class="fas fa-user-md me-2"></i>Doctores
                </a>
              </li>
              <li class="nav-item mb-2">
                <a class="nav-link active" href="/users/management">
                  <i class="fas fa-users me-2"></i>Usuarios
                </a>
              </li>
              <li class="nav-item mb-2">
                <a class="nav-link" href="/admins/profile">
                  <i class="fas fa-cog me-2"></i>Configuración
                </a>
              </li>
            </ul>
          </div>
        </nav>

        <!-- Main Content -->
        <main class="col-md-9 ms-sm-auto col-lg-10 px-4 main-content">
          <!-- Header -->
          <div
            class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-4 border-bottom"
          >
            <h1 class="h2 text-primary">
              <i class="fas fa-users me-2"></i>Gestión de Usuarios
            </h1>
            <div class="btn-toolbar mb-2 mb-md-0">
              <button class="btn btn-primary" id="add-user-btn">
                <i class="fas fa-plus me-1"></i>Agregar Usuario
              </button>
            </div>
          </div>

          <!-- Buscador y Filtros -->
          <div class="row mb-4">
            <div class="col-md-6">
              <div class="search-box">
                <i class="fas fa-search"></i>
                <input
                  type="text"
                  class="form-control"
                  id="search-users"
                  placeholder="Buscar usuarios..."
                />
              </div>
            </div>
            <div class="col-md-3">
              <select class="form-select" id="filter-doctor">
                <option value="">Todos los doctores</option>
                <!-- Los doctores se cargarán dinámicamente -->
              </select>
            </div>
            <div class="col-md-3">
              <select class="form-select" id="filter-status">
                <option value="">Todos los estados</option>
                <option value="active">Activo</option>
                <option value="inactive">Inactivo</option>
              </select>
            </div>
          </div>

          <!-- Cards de Usuarios -->
          <div class="row" id="users-container">
            <!-- Las cards de usuarios se cargarán aquí dinámicamente -->
          </div>

          <!-- Mensaje cuando no hay usuarios -->
          <div class="text-center py-5 d-none" id="no-users-message">
            <i class="fas fa-users fa-3x text-muted mb-3"></i>
            <h4 class="text-muted">No hay usuarios registrados</h4>
            <p class="text-muted">
              Comienza agregando el primer usuario al sistema.
            </p>
            <button class="btn btn-primary" id="add-first-user">
              <i class="fas fa-plus me-1"></i>Agregar Primer Usuario
            </button>
          </div>

          <!-- Loading Spinner -->
          <div class="text-center py-5" id="loading-users">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Cargando...</span>
            </div>
            <p class="mt-2 text-muted">Cargando usuarios...</p>
          </div>
        </main>
      </div>
    </div>

    <!-- Modal para Agregar/Editar Usuario -->
    <div
      class="modal fade"
      id="userModal"
      tabindex="-1"
      aria-labelledby="userModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="userModalLabel">
              Agregar Nuevo Usuario
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form id="user-form">
              <input type="hidden" id="user-id" />
              <div class="row">
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="user-name" class="form-label"
                      >Nombre Completo</label
                    >
                    <input
                      type="text"
                      class="form-control"
                      id="user-nombre"
                      required
                    />
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="user-email" class="form-label">Email</label>
                    <input
                      type="email"
                      class="form-control"
                      id="user-email"
                      required
                    />
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="user-password" class="form-label"
                      >Contraseña</label
                    >
                    <input
                      type="password"
                      class="form-control"
                      id="user-password"
                      required
                    />
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="user-doctor" class="form-label"
                      >Doctor Asignado</label
                    >
                    <select class="form-select" id="user-doctor" required>
                      <option value="">Seleccionar doctor</option>
                      <!-- Los doctores se cargarán dinámicamente -->
                    </select>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="user-birthdate" class="form-label"
                      >Fecha de Nacimiento</label
                    >
                    <input
                      type="date"
                      class="form-control"
                      id="user-birthdate"
                      required
                    />
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="user-gender" class="form-label">Género</label>
                    <select class="form-select" id="user-gender" required>
                      <option value="">Seleccionar género</option>
                      <option value="M">Masculino</option>
                      <option value="F">Femenino</option>
                      <option value="O">Otro</option>
                    </select>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-md-4">
                  <div class="mb-3">
                    <label for="user-height" class="form-label"
                      >Altura (cm)</label
                    >
                    <input
                      type="number"
                      class="form-control"
                      id="user-height"
                      required
                    />
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="mb-3">
                    <label for="user-weight" class="form-label"
                      >Peso Actual (kg)</label
                    >
                    <input
                      type="number"
                      class="form-control"
                      id="user-weight"
                      required
                    />
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="mb-3">
                    <label for="user-goal-weight" class="form-label"
                      >Peso Objetivo (kg)</label
                    >
                    <input
                      type="number"
                      class="form-control"
                      id="user-goal-weight"
                    />
                  </div>
                </div>
              </div>
              <div class="mb-3">
                <label for="user-activity" class="form-label"
                  >Nivel de Actividad</label
                >
                <select class="form-select" id="user-activity" required>
                  <option value="">Seleccionar nivel de actividad</option>
                  <option value="sedentario">Sedentario</option>
                  <option value="moderado">Moderado</option>
                  <option value="activo">Activo</option>
                  <option value="muy_activo">Muy Activo</option>
                </select>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Cancelar
            </button>
            <button type="button" class="btn btn-primary" id="save-user">
              Guardar Usuario
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal de Confirmación de Eliminación -->
    <div
      class="modal fade"
      id="deleteUserModal"
      tabindex="-1"
      aria-labelledby="deleteUserModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="deleteUserModalLabel">
              Confirmar Eliminación
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <p>
              ¿Estás seguro de que deseas eliminar al usuario
              <strong id="user-to-delete-name"></strong>?
            </p>
            <p class="text-danger">
              <small>Esta acción no se puede deshacer.</small>
            </p>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Cancelar
            </button>
            <button
              type="button"
              class="btn btn-danger"
              id="confirm-delete-user"
            >
              Eliminar Usuario
            </button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      class UsersManager {
        constructor() {
          this.baseURL = window.location.origin;
          this.users = [];
          this.doctors = [];
          this.filteredUsers = [];
          this.currentUserId = null;
          this.init();
        }

        async init() {
          await this.checkAuth();
          await this.loadAdminInfo();
          this.setupEventListeners();
          await this.loadDoctors();
          await this.loadUsers();
        }

        async checkAuth() {
          const token = localStorage.getItem('access_token');
          if (!token) {
            window.location.href = '/auth/login';
            return false;
          }
          return true;
        }

        async makeAuthenticatedRequest(url, options = {}) {
          const token = localStorage.getItem('access_token');
          const defaultOptions = {
            headers: {
              Authorization: `Bearer ${token}`,
              'Content-Type': 'application/json',
            },
          };
          const mergedOptions = { ...defaultOptions, ...options };

          try {
            const response = await fetch(url, mergedOptions);
            if (response.status === 401) {
              this.logout();
              return null;
            }
            return response;
          } catch (error) {
            console.error('Request failed:', error);
            return null;
          }
        }

        async loadAdminInfo() {
          const response =
            await this.makeAuthenticatedRequest('/admins/api/me');
          if (response && response.ok) {
            const admin = await response.json();
            document.getElementById('user-name').textContent = admin.nombre;
          }
        }

        async loadDoctors() {
          const response = await this.makeAuthenticatedRequest('/doctors');
          if (response && response.ok) {
            this.doctors = await response.json();
            this.populateDoctorFilters();
          }
        }

        async loadUsers() {
          this.showLoading(true);
          const response = await this.makeAuthenticatedRequest('/users');
          if (response && response.ok) {
            this.users = await response.json();
            this.filteredUsers = [...this.users];
            this.renderUsers();
          } else {
            console.error('Error loading users');
          }
          this.showLoading(false);
        }

        populateDoctorFilters() {
          const doctorFilter = document.getElementById('filter-doctor');
          const userDoctorSelect = document.getElementById('user-doctor');

          // Clear existing options except the first one
          while (doctorFilter.children.length > 1) {
            doctorFilter.removeChild(doctorFilter.lastChild);
          }
          while (userDoctorSelect.children.length > 1) {
            userDoctorSelect.removeChild(userDoctorSelect.lastChild);
          }

          // Add doctor options
          this.doctors.forEach((doctor) => {
            const option = document.createElement('option');
            option.value = doctor.id;
            option.textContent = doctor.nombre;

            doctorFilter.appendChild(option.cloneNode(true));
            userDoctorSelect.appendChild(option);
          });
        }

        renderUsers() {
          const container = document.getElementById('users-container');
          const noUsersMessage = document.getElementById('no-users-message');

          if (this.filteredUsers.length === 0) {
            container.classList.add('d-none');
            noUsersMessage.classList.remove('d-none');
            return;
          }

          container.classList.remove('d-none');
          noUsersMessage.classList.add('d-none');

          container.innerHTML = this.filteredUsers
            .map((user) => {
              const doctor = this.doctors.find((d) => d.id === user.doctorId);
              const doctorName = doctor ? doctor.nombre : 'No asignado';

              return `
                    <div class="col-md-6 col-lg-4 col-xl-3 mb-4">
                        <div class="card user-card h-100">
                            <div class="card-body">
                                <div class="d-flex align-items-start mb-3">
                                    <div class="rounded-circle bg-primary d-flex align-items-center justify-content-center me-3" style="width: 50px; height: 50px;">
                                        <i class="fas fa-user text-white"></i>
                                    </div>
                                    <div>
                                        <h5 class="card-title mb-1">${user.nombre}</h5>
                                        <p class="card-text text-muted small mb-1">${user.email}</p>
                                        <p class="card-text small mb-0">Doctor: ${doctorName}</p>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <span class="badge bg-info user-info-badge ms-1">${this.getGenderDisplay(user.genero)}</span>
                                    <span class="badge bg-secondary user-info-badge ms-1">${user.edad || this.calculateAge(user.fechaNacimiento)} años</span>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <button class="btn btn-sm btn-outline-primary edit-user" data-id="${user.id}">
                                        <i class="fas fa-edit me-1"></i>Editar
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger delete-user" data-id="${user.id}" data-name="${user.nombre}">
                                        <i class="fas fa-trash me-1"></i>Eliminar
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    `;
            })
            .join('');

          // Add event listeners to edit and delete buttons
          container.querySelectorAll('.edit-user').forEach((btn) => {
            btn.addEventListener('click', (e) => {
              const userId = e.currentTarget.getAttribute('data-id');
              this.editUser(userId);
            });
          });

          container.querySelectorAll('.delete-user').forEach((btn) => {
            btn.addEventListener('click', (e) => {
              const userId = e.currentTarget.getAttribute('data-id');
              const userName = e.currentTarget.getAttribute('data-name');
              this.confirmDeleteUser(userId, userName);
            });
          });
        }

        getGenderDisplay(gender) {
          const genders = {
            masculino: 'Masculino',
            femenino: 'Femenino',
            otro: 'Otro',
          };
          return genders[gender] || gender;
        }

        calculateAge(birthDate) {
          if (!birthDate) return 'N/A';
          const today = new Date();
          const birth = new Date(birthDate);
          let age = today.getFullYear() - birth.getFullYear();
          const monthDiff = today.getMonth() - birth.getMonth();

          if (
            monthDiff < 0 ||
            (monthDiff === 0 && today.getDate() < birth.getDate())
          ) {
            age--;
          }

          return age;
        }

        setupEventListeners() {
          // Logout
          document
            .getElementById('logout-btn')
            .addEventListener('click', (e) => {
              e.preventDefault();
              this.logout();
            });

          // Add user button
          document
            .getElementById('add-user-btn')
            .addEventListener('click', () => {
              this.openAddUserModal();
            });

          document
            .getElementById('add-first-user')
            .addEventListener('click', () => {
              this.openAddUserModal();
            });

          // Save user
          document.getElementById('save-user').addEventListener('click', () => {
            this.saveUser();
          });

          // Search and filter
          document
            .getElementById('search-users')
            .addEventListener('input', (e) => {
              this.filterUsers();
            });

          document
            .getElementById('filter-doctor')
            .addEventListener('change', () => {
              this.filterUsers();
            });

          document
            .getElementById('filter-status')
            .addEventListener('change', () => {
              this.filterUsers();
            });

          // Confirm delete
          document
            .getElementById('confirm-delete-user')
            .addEventListener('click', () => {
              this.deleteUser();
            });
        }

        filterUsers() {
          const searchTerm = document
            .getElementById('search-users')
            .value.toLowerCase();
          const doctorFilter = document.getElementById('filter-doctor').value;
          const statusFilter = document.getElementById('filter-status').value;

          this.filteredUsers = this.users.filter((user) => {
            const matchesSearch =
              user.nombre.toLowerCase().includes(searchTerm) ||
              user.email.toLowerCase().includes(searchTerm);
            const matchesDoctor =
              !doctorFilter || user.doctorId === doctorFilter;
            const matchesStatus = !statusFilter || user.estado === statusFilter;

            return matchesSearch && matchesDoctor && matchesStatus;
          });

          this.renderUsers();
        }

        openAddUserModal() {
          document.getElementById('userModalLabel').textContent =
            'Agregar Nuevo Usuario';
          document.getElementById('user-form').reset();
          document.getElementById('user-id').value = '';
          document.getElementById('user-password').required = true;

          const modal = new bootstrap.Modal(
            document.getElementById('userModal'),
          );
          modal.show();
        }

        async editUser(userId) {
          const user = this.users.find((u) => u.id === userId);
          if (!user) return;

          document.getElementById('userModalLabel').textContent =
            'Editar Usuario';
          document.getElementById('user-id').value = user.id;
          document.getElementById('user-nombre').value = user.nombre;
          document.getElementById('user-email').value = user.email;
          document.getElementById('user-password').required = false;
          document.getElementById('user-password').placeholder =
            'Dejar en blanco para mantener la contraseña actual';
          document.getElementById('user-doctor').value = user.doctorId || '';
          document.getElementById('user-birthdate').value =
            user.fecha_nacimiento || '';
          document.getElementById('user-gender').value = user.género || '';
          document.getElementById('user-height').value = user.altura || '';
          document.getElementById('user-weight').value = user.peso_actual || '';
          document.getElementById('user-goal-weight').value =
            user.objetivo_peso || '';
          document.getElementById('user-activity').value =
            user.nivel_actividad || '';

          const modal = new bootstrap.Modal(
            document.getElementById('userModal'),
          );
          modal.show();
        }

        async saveUser() {
          const form = document.getElementById('user-form');
          if (!form.checkValidity()) {
            form.reportValidity();
            return;
          }

          const userData = {
            nombre: document.getElementById('user-nombre').value,
            email: document.getElementById('user-email').value,
            fecha_nacimiento: document.getElementById('user-birthdate').value,
            género: document.getElementById('user-gender').value,
            altura: parseFloat(document.getElementById('user-height').value),
            peso_actual: parseFloat(
              document.getElementById('user-weight').value,
            ),
            nivel_actividad: document.getElementById('user-activity').value,
          };

          // Add optional fields if provided
          const goalWeight = document.getElementById('user-goal-weight').value;
          if (goalWeight) {
            userData.objetivo_peso = parseFloat(goalWeight);
          }

          const doctorId = document.getElementById('user-doctor').value;
          if (doctorId) {
            userData.doctorId = doctorId;
          }

          // Add password only if provided or when creating new user
          const password = document.getElementById('user-password').value;
          if (password) {
            userData.contraseña = password;
          }

          const userId = document.getElementById('user-id').value;

          // LOG: Mostrar los datos que se enviarán al backend
          console.log('Datos a enviar al backend (User):', userData);

          let response;

          if (userId) {
            // Update existing user
            response = await this.makeAuthenticatedRequest(`/users/${userId}`, {
              method: 'PATCH',
              body: JSON.stringify(userData),
            });
          } else {
            // Create new user
            response = await this.makeAuthenticatedRequest('/users', {
              method: 'POST',
              body: JSON.stringify(userData),
            });
          }

          if (response && response.ok) {
            bootstrap.Modal.getInstance(
              document.getElementById('userModal'),
            ).hide();
            await this.loadUsers();
          } else {
            alert(
              'Error al guardar el usuario. Por favor, intente nuevamente.',
            );
          }
        }

        confirmDeleteUser(userId, userName) {
          this.currentUserId = userId;
          document.getElementById('user-to-delete-name').textContent = userName;
          const modal = new bootstrap.Modal(
            document.getElementById('deleteUserModal'),
          );
          modal.show();
        }

        async deleteUser() {
          if (!this.currentUserId) return;

          const response = await this.makeAuthenticatedRequest(
            `/users/${this.currentUserId}`,
            {
              method: 'DELETE',
            },
          );

          if (response && response.ok) {
            bootstrap.Modal.getInstance(
              document.getElementById('deleteUserModal'),
            ).hide();
            await this.loadUsers();
          } else {
            alert(
              'Error al eliminar el usuario. Por favor, intente nuevamente.',
            );
          }
        }

        showLoading(show) {
          const loadingElement = document.getElementById('loading-users');
          if (show) {
            loadingElement.classList.remove('d-none');
            document.getElementById('users-container').classList.add('d-none');
            document.getElementById('no-users-message').classList.add('d-none');
          } else {
            loadingElement.classList.add('d-none');
          }
        }

        logout() {
          localStorage.removeItem('access_token');
          localStorage.removeItem('refresh_token');
          window.location.href = '/auth/login';
        }
      }

      // Initialize the users manager when the DOM is ready
      document.addEventListener('DOMContentLoaded', () => {
        new UsersManager();
      });
    </script>
  </body>
</html>
